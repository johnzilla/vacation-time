{% extends "base.html" %}

{% block content %}
<article>
    <header>
        <h1>Find Your Best Vacation Days</h1>
        <p>Enter your available PTO and we'll find the optimal times to maximize your days off.</p>
    </header>

    <form hx-post="/results" hx-target="#results" hx-indicator="#loading">
        <div class="grid">
            <label>
                Country
                <select name="country" required>
                    <option value="">Select a country...</option>
                    {% for country in countries %}
                    <option value="{{ country.code }}">{{ country.name }}</option>
                    {% endfor %}
                </select>
            </label>

            <label>
                PTO Days Available
                <input type="number" name="pto_days" min="1" max="30" value="5" required>
            </label>
        </div>

        <div class="grid">
            <label>
                Start Date
                <input type="date" name="start_date" id="start_date" required>
            </label>

            <label>
                End Date
                <input type="date" name="end_date" id="end_date" required>
            </label>
        </div>

        <fieldset>
            <legend>Work Days</legend>
            <div class="work-days-grid">
                <label>
                    <input type="checkbox" name="work_days" value="0" checked>
                    Monday
                </label>
                <label>
                    <input type="checkbox" name="work_days" value="1" checked>
                    Tuesday
                </label>
                <label>
                    <input type="checkbox" name="work_days" value="2" checked>
                    Wednesday
                </label>
                <label>
                    <input type="checkbox" name="work_days" value="3" checked>
                    Thursday
                </label>
                <label>
                    <input type="checkbox" name="work_days" value="4" checked>
                    Friday
                </label>
                <label>
                    <input type="checkbox" name="work_days" value="5">
                    Saturday
                </label>
                <label>
                    <input type="checkbox" name="work_days" value="6">
                    Sunday
                </label>
            </div>
        </fieldset>

        <details>
            <summary>Advanced Options</summary>
            <label>
                State/Region Code (optional)
                <input type="text" name="subdivision" placeholder="e.g., CA, NY, TX">
                <small>Some countries have region-specific holidays</small>
            </label>
        </details>

        <button type="submit">Find Best Vacation Times</button>
    </form>

    <div id="loading" class="htmx-indicator">
        <p aria-busy="true">Analyzing vacation options...</p>
    </div>

    <div id="results"></div>
</article>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const startDate = document.getElementById('start_date');
    const endDate = document.getElementById('end_date');

    startDate.addEventListener('change', function() {
        if (this.value) {
            // Set min date for end date to day after start date
            const nextDay = new Date(this.value);
            nextDay.setDate(nextDay.getDate() + 1);
            const minDate = nextDay.toISOString().split('T')[0];
            endDate.min = minDate;

            // If end date is empty or before new min, set it to day after start
            if (!endDate.value || endDate.value < minDate) {
                endDate.value = minDate;
            }
        }
    });
});
</script>
{% endblock %}
